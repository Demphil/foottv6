name: Update Matches Data

on:
  schedule:
    - cron: '0 */3 * * *'
  workflow_dispatch:

jobs:
  update-matches:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true
          fetch-depth: 0

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Create Matches Data
        run: |
          mkdir -p data
          cat << 'EOF' > data/matches.json
          {
            "today": [
              {
                "id": "match-$(date +%s)",
                "homeTeam": {
                  "name": "Ø§Ù„Ù‡Ù„Ø§Ù„",
                  "logo": "/images/teams/alhilal.png"
                },
                "awayTeam": {
                  "name": "Ø§Ù„Ù†ØµØ±",
                  "logo": "/images/teams/alnassr.png"
                },
                "score": "VS",
                "time": "21:00",
                "date": "$(date -u +'%Y-%m-%dT21:00:00Z')",
                "league": {
                  "name": "Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ",
                  "logo": "/images/leagues/spl.png"
                },
                "channels": ["bein SPORTS HD1"],
                "status": "Ù‚Ø§Ø¯Ù…"
              }
            ],
            "tomorrow": [],
            "updatedAt": "$(date -u +'%Y-%m-%dT%H:%M:%SZ')"
          }
          EOF

      - name: Commit & Push Changes
        run: |
          git add data/matches.json
          git diff --cached --quiet || (git commit -m "ðŸ”„ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª [auto]")
          git push
