name: Update Matches Data

on:
  schedule:
    - cron: '0 */3 * * *'  # كل 3 ساعات
  workflow_dispatch:

jobs:
  update-matches:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Create Matches Data
        run: |
          mkdir -p data
          cat << 'EOF' > data/matches.json
          {
            "today": [
              {
                "id": "match-1",
                "homeTeam": {
                  "name": "الهلال",
                  "logo": "https://kooora.live-kooora.com//logos/alhilal.png"
                },
                "awayTeam": {
                  "name": "النصر", 
                  "logo": "https://kooora.live-kooora.com//logos/alnassr.png"
                },
                "score": "VS",
                "time": "21:00",
                "date": "$(date -u +'%Y-%m-%dT21:00:00Z')",
                "league": {
                  "name": "الدوري السعودي",
                  "logo": "https://kooora.live-kooora.com//logos/spl.png"
                },
                "channels": ["bein SPORTS HD1"],
                "status": "قادم",
                "isFeatured": true
              }
            ],
            "tomorrow": [],
            "updatedAt": "$(date -u +'%Y-%m-%dT%H:%M:%SZ')"
          }
          EOF

      - name: Verify Data
        run: |
          echo "📂 محتوى ملف matches.json:"
          cat assets/data/matches.json
          echo ""
          echo "🔄 عدد مباريات اليوم: $(jq '.today | length' assets/data/matches.json)"
          echo "⏱ وقت التحديث: $(jq -r '.updatedAt' assets/data/matches.json)"

      - name: Commit & Push Changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add assets/data/matches.json
          git commit -m "🔄 تحديث بيانات المباريات [skip ci]" || echo "لا يوجد تغييرات جديدة"
          git push
